---
title: "Walmart Project"
author: "Hai Phan"
format: docx
editor: visual
---

## Research Question

Average temperatures have been rising over time. In the short term, Wal-Mart is curious whether this might hurt its sales. **In these stores, do higher temperatures causally affect sales?**

## Data

The CSV file Walmart_Sales.csv contains sales data for 45 Walmart stores from February 2010 through October 2012. This data contains the columns:

Store: the store number

Date: the week of the sale in day-month-year format

Weekly_Sales: the sales for the given store in the given week

Holiday_Flag: whether the week is a special holiday week (1) or not

Temperature: the average temperature in the region (in Fahrenheit)

Fuel_Price: the cost of fuel in the region (in dollars per gallon)

CPI: the consumer price index

Unemployment: the unemployment rate in the region

I chose Weekly_Sales as the outcome and Temperature as the main explanatory variable. I also identified controls: Holiday_Flag, Fuel_Price, CPI, Unemployment, and I planned to use store fixed effects to reduce bias from differences across stores.

## Running Code

```{r}
library(lubridate)
library(ggplot2)
library(lmtest)
library(sandwich)
```

-   **Step 1: Load the data**

I imported the dataset into R using `read.csv("Walmart_Sales.csv")`.

-   **Step 2: Quick check**

I checked the dataset structure to make sure the variables loaded correctly.

I first converted Date from text to a real date format so the timeline is handled correctly. Then I converted Store to a factor so I could include store fixed effects, which compares changes within the same store over time instead of across different stores. Finally, I converted Holiday_Flag to a factor because it is a 0/1 indicator, making it easier to model and interpret in the regression.

```{r}
Walmart_Sales <- read.csv("Walmart_Sales.csv")
Walmart_Sales$Date <- dmy(Walmart_Sales$Date)
Walmart_Sales$Store <- factor(Walmart_Sales$Store)
Walmart_Sales$Holiday_Flag <- factor(Walmart_Sales$Holiday_Flag)
```

-   **Step 3: Exploratory plot (visual check)**

The scatter plot with a fitted linear trend suggests a slightly negative relationship between temperature and weekly sales. Sales tend to decrease modestly as temperature rises. However, the points are widely dispersed, indicating substantial variation in sales at any given temperature level. This pattern is consistent with the fact that the data pool many stores and weeks, and weekly sales are influenced by multiple factors beyond temperature; therefore, the plot is descriptive and motivates the need for regression controls and store fixed effects.

```{r}
ggplot(Walmart_Sales, aes(x = Temperature, y = Weekly_Sales)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm", se = TRUE) +
  labs(title = "Weekly Sales vs Temperature", x = "Temperature", y = "Weekly Sales")
```

-   **Step 4: Regression Models**

I estimated three regressions to see how the temperature effect changes as I control for more confounding factors:

**Model 1 (baseline):** Weekly Sales \~ Temperature

```{r}
m1 <- lm(Weekly_Sales ~ Temperature, data = Walmart_Sales)
```

**Model 2 (with controls):** Weekly_Sales \~ Temperature + Holiday_Flag + Fuel_Price + CPI + Unemployment

```{r}
m2 <- lm(Weekly_Sales ~ Temperature + Holiday_Flag + Fuel_Price + CPI + Unemployment, data = Walmart_Sales)
```

**Model 3 (store fixed effects):** Weekly_Sales \~ Temperature + Holiday_Flag + Fuel_Price + CPI + Unemployment + Store

```{r}
m3 <- lm(Weekly_Sales ~ Temperature + Holiday_Flag + Fuel_Price + CPI + Unemployment + Store, data = Walmart_Sales)
```

```{r}
coef(m1)["Temperature"]
coef(m2)["Temperature"]
summary(m3)$coefficients["Temperature", ]
```

After running Model 3, I checked whether the temperature result was trustworthy or just happened by chance. I did this by looking at the p value for the Temperature coefficient. A small p value means the result is statistically significant, so we can be more confident that temperature is related to weekly sales in the data. In my output, the temperature coefficient is negative and the p value is very small, so higher temperature is linked to lower weekly sales.

I also used clustered standard errors by store because the same store appears many times across different weeks. Weeks from the same store often look similar because each store has its own repeated sales pattern over time. If we ignore this and treat every row as completely independent, the standard errors can be too small and the result can look more significant than it really is. Clustering fixes this by allowing observations within the same store to be related. After clustering by store, the temperature result is still significant with a p value of 0.005, so the negative relationship remains even when using a more careful approach.

```{r}
getwd()
```

-   **Step 5: Conclusion**

Overall, the analysis suggests that higher temperatures are linked to lower weekly sales in this Walmart dataset. In the preferred model with controls and store fixed effects, the temperature coefficient is about negative 834, meaning that when temperature increases by one unit, weekly sales in the same store tend to decrease by around 834 dollars on average. This result remains statistically significant even when I use standard errors clustered by store, which makes the inference more reliable for repeated store week data.

At the same time, a causal interpretation still depends on an important assumption. Even with store fixed effects and the included controls, there could be other factors that change over time within a store and are related to temperature and sales at the same time. For example, local events, seasonal shopping patterns, or store specific promotions might move with weather conditions and also affect sales. Because of these possible unobserved time varying factors, the results provide strong evidence of a negative relationship and are consistent with a causal effect, but they should still be interpreted with caution.

```{}
```
